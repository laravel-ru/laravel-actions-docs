<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Authorisation | Laravel Actions</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo_icon.png">
    <meta name="description" content="Запускайте свои простые классы PHP как угодно.">
    <meta property="article:modified_time" content="2020-12-23T10:25:04.000Z">
    <meta property="og:site_name" content="Laravel Actions">
    <meta property="og:title" content="Authorisation">
    <meta property="og:description" content="Запускайте свои простые классы PHP как угодно.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/1.x/authorisation.html">
    <meta property="og:image" content="https://actions.getlaravel.ru/hero2-social.jpg">
    <meta name="twitter:title" content="Authorisation">
    <meta name="twitter:description" content="Запускайте свои простые классы PHP как угодно.">
    <meta name="twitter:url" content="/1.x/authorisation.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://actions.getlaravel.ru/hero2-social.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.8c17a15f.css" as="style"><link rel="preload" href="/assets/js/app.eda28e7b.js" as="script"><link rel="preload" href="/assets/js/2.6967e0a2.js" as="script"><link rel="preload" href="/assets/js/16.ef8e4872.js" as="script"><link rel="prefetch" href="/assets/js/10.459583ad.js"><link rel="prefetch" href="/assets/js/11.fea738ad.js"><link rel="prefetch" href="/assets/js/12.46ee50a7.js"><link rel="prefetch" href="/assets/js/13.122e5777.js"><link rel="prefetch" href="/assets/js/14.94dace71.js"><link rel="prefetch" href="/assets/js/15.898078d0.js"><link rel="prefetch" href="/assets/js/17.e91a81f1.js"><link rel="prefetch" href="/assets/js/18.4cfc85a6.js"><link rel="prefetch" href="/assets/js/19.298db443.js"><link rel="prefetch" href="/assets/js/20.eedadc8a.js"><link rel="prefetch" href="/assets/js/21.81581cf4.js"><link rel="prefetch" href="/assets/js/22.d06ffd39.js"><link rel="prefetch" href="/assets/js/23.6a74cedf.js"><link rel="prefetch" href="/assets/js/24.3379e3c4.js"><link rel="prefetch" href="/assets/js/25.f3d80d34.js"><link rel="prefetch" href="/assets/js/26.fb302595.js"><link rel="prefetch" href="/assets/js/27.13820ac9.js"><link rel="prefetch" href="/assets/js/28.2d1b5167.js"><link rel="prefetch" href="/assets/js/29.e0df7720.js"><link rel="prefetch" href="/assets/js/3.3423f2fc.js"><link rel="prefetch" href="/assets/js/30.ffd24821.js"><link rel="prefetch" href="/assets/js/31.ab297ceb.js"><link rel="prefetch" href="/assets/js/32.dca90912.js"><link rel="prefetch" href="/assets/js/33.ccaf437a.js"><link rel="prefetch" href="/assets/js/34.b46cb3e5.js"><link rel="prefetch" href="/assets/js/35.2141f041.js"><link rel="prefetch" href="/assets/js/36.3fc6ceeb.js"><link rel="prefetch" href="/assets/js/37.884690db.js"><link rel="prefetch" href="/assets/js/38.8e440c5d.js"><link rel="prefetch" href="/assets/js/39.64adb446.js"><link rel="prefetch" href="/assets/js/4.09fd2c39.js"><link rel="prefetch" href="/assets/js/40.13ad04b1.js"><link rel="prefetch" href="/assets/js/41.0e7a1fbd.js"><link rel="prefetch" href="/assets/js/42.e2268095.js"><link rel="prefetch" href="/assets/js/43.d77b6d02.js"><link rel="prefetch" href="/assets/js/44.44095657.js"><link rel="prefetch" href="/assets/js/45.8fc2926c.js"><link rel="prefetch" href="/assets/js/46.3c09e020.js"><link rel="prefetch" href="/assets/js/47.3bf24504.js"><link rel="prefetch" href="/assets/js/48.ee5a21c5.js"><link rel="prefetch" href="/assets/js/5.749fdd99.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.bd4ddb9c.js"><link rel="prefetch" href="/assets/js/8.e75b1d66.js"><link rel="prefetch" href="/assets/js/9.74ddecf3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8c17a15f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_icon.png" alt="Laravel Actions" class="logo"> <span class="site-name can-hide">Laravel Actions</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Версия" class="dropdown-title"><span class="title">Версия</span> <span class="arrow down"></span></button> <button type="button" aria-label="Версия" class="mobile-dropdown-title"><span class="title">Версия</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.x
</a></li><li class="dropdown-item"><!----> <a href="/1.x/" class="nav-link router-link-active">
  1.x
</a></li></ul></div></div> <a href="https://github.com/lorisleiva/laravel-actions" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Версия" class="dropdown-title"><span class="title">Версия</span> <span class="arrow down"></span></button> <button type="button" aria-label="Версия" class="mobile-dropdown-title"><span class="title">Версия</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.x
</a></li><li class="dropdown-item"><!----> <a href="/1.x/" class="nav-link router-link-active">
  1.x
</a></li></ul></div></div> <a href="https://github.com/lorisleiva/laravel-actions" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/1.x/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/1.x/installation.html" class="sidebar-link">Installation</a></li><li><a href="/1.x/basic-usage.html" class="sidebar-link">Basic usage</a></li><li><a href="/1.x/actions-attributes.html" class="sidebar-link">Actions' attributes</a></li><li><a href="/1.x/dependency-injections.html" class="sidebar-link">Dependency injections</a></li><li><a href="/1.x/authorisation.html" aria-current="page" class="active sidebar-link">Authorisation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/1.x/authorisation.html#the-authorize-method" class="sidebar-link">The authorize method</a></li><li class="sidebar-sub-header"><a href="/1.x/authorisation.html#the-user-and-actingas-methods" class="sidebar-link">The user and actingAs methods</a></li><li class="sidebar-sub-header"><a href="/1.x/authorisation.html#the-can-method" class="sidebar-link">The can method</a></li></ul></li><li><a href="/1.x/validation.html" class="sidebar-link">Validation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Actions as...</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/1.x/actions-as-objects.html" class="sidebar-link">Actions as objects</a></li><li><a href="/1.x/actions-as-jobs.html" class="sidebar-link">Actions as jobs</a></li><li><a href="/1.x/actions-as-listeners.html" class="sidebar-link">Actions as listeners</a></li><li><a href="/1.x/actions-as-controllers.html" class="sidebar-link">Actions as controllers</a></li><li><a href="/1.x/actions-as-commands.html" class="sidebar-link">Actions as commands</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Advanced</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/1.x/registering-actions.html" class="sidebar-link">Registering actions</a></li><li><a href="/1.x/action-running-as.html" class="sidebar-link">Keeping track of how an action was run</a></li><li><a href="/1.x/nested-actions.html" class="sidebar-link">Actions within actions</a></li><li><a href="/1.x/action-lifecycle.html" class="sidebar-link">The lifecycle of an action</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="authorisation"><a href="#authorisation" class="header-anchor">#</a> Authorisation</h1> <p>No matter how actions are run, you can define some authorisation logic directly within the action to make sure that it is performed under valid circumstances. For example, this could ensure the authenticated user has the appropriate role before continuing.</p> <p>Note that, just like in a Laravel FormRequest, the authorisation logic occurs before the validation logic (<a href="/1.x/validation.html">see next page</a>).</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>The page &quot;<a href="/1.x/action-lifecycle.html">The lifecycle of an action</a>&quot; provides a handy summary of all methods that an Action will call before and after executing the <code>handle</code> method.</p></div> <h2 id="the-authorize-method"><a href="#the-authorize-method" class="header-anchor">#</a> The <code>authorize</code> method</h2> <p>Actions can define their authorisation logic using the <code>authorize</code> method. It should return a boolean indicating if we are authorised to execute this action.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Your authorisation logic here...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>authorize</code> method is optional and defaults to <code>true</code> when not provided.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is worth noting that, just like the <code>handle</code> method, the <code>authorize</code> method <a href="/1.x/dependency-injections.html">supports dependency injections</a>.</p></div> <p>Whenever the <code>authorize</code> method returns <code>false</code>, it will throw an <code>AuthorizationException</code> resulting in a 403 status code when used in the HTTP layer (as a controller for example).</p> <p>You can change that behaviour by overriding the <code>failedAuthorization</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">failedAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyCustomExceptionForWhenAnActionIsUnauthorized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-user-and-actingas-methods"><a href="#the-user-and-actingas-methods" class="header-anchor">#</a> The <code>user</code> and <code>actingAs</code> methods</h2> <p>If you want to access the authenticated user from an action you can simply use the <code>user</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When run as a controller, the user is fetched from the incoming request, otherwise <code>$this-&gt;user()</code> is equivalent to <code>Auth::user()</code>.</p> <p>If you want to run an action acting on behalf of another user you can use the <code>actingAs</code> method. In this case, the <code>user</code> method will always return the provided user.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$action</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">actingAs</span><span class="token punctuation">(</span><span class="token variable">$admin</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="the-can-method"><a href="#the-can-method" class="header-anchor">#</a> The <code>can</code> method</h2> <p>If you’d still like to use Gates and Policies to externalise your authorisation logic, you can use the <code>can</code> helper method to verify that the user can perform the provided ability.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> Article<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/laravel-ru/laravel-actions-docs/edit/main-ru/1.x/authorisation.md" target="_blank" rel="noopener noreferrer">Редактировать эту страницу</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Последнее обновление:</span> <span class="time">12/23/2020, 1:25:04 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/1.x/dependency-injections.html" class="prev">
        Dependency injections
      </a></span> <span class="next"><a href="/1.x/validation.html">
        Validation
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.eda28e7b.js" defer></script><script src="/assets/js/2.6967e0a2.js" defer></script><script src="/assets/js/16.ef8e4872.js" defer></script>
  </body>
</html>
