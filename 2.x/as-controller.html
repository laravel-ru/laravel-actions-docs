<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>As controller | Laravel Actions</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo_icon.png">
    <meta name="description" content="Запускайте свои простые классы PHP как угодно.">
    <meta property="article:modified_time" content="2021-01-08T15:08:02.000Z">
    <meta property="og:site_name" content="Laravel Actions">
    <meta property="og:title" content="As controller">
    <meta property="og:description" content="Запускайте свои простые классы PHP как угодно.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/2.x/as-controller.html">
    <meta property="og:image" content="https://actions.getlaravel.ru/hero2-social.jpg">
    <meta name="twitter:title" content="As controller">
    <meta name="twitter:description" content="Запускайте свои простые классы PHP как угодно.">
    <meta name="twitter:url" content="/2.x/as-controller.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://actions.getlaravel.ru/hero2-social.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.9acbc36c.css" as="style"><link rel="preload" href="/assets/js/app.97df651c.js" as="script"><link rel="preload" href="/assets/js/2.6967e0a2.js" as="script"><link rel="preload" href="/assets/js/25.b1944ca4.js" as="script"><link rel="prefetch" href="/assets/js/10.7a4c4ac3.js"><link rel="prefetch" href="/assets/js/11.204d32ed.js"><link rel="prefetch" href="/assets/js/12.ee11598e.js"><link rel="prefetch" href="/assets/js/13.0ae5f196.js"><link rel="prefetch" href="/assets/js/14.94dace71.js"><link rel="prefetch" href="/assets/js/15.898078d0.js"><link rel="prefetch" href="/assets/js/16.559405a9.js"><link rel="prefetch" href="/assets/js/17.e91a81f1.js"><link rel="prefetch" href="/assets/js/18.4cfc85a6.js"><link rel="prefetch" href="/assets/js/19.f78e9f52.js"><link rel="prefetch" href="/assets/js/20.14136f34.js"><link rel="prefetch" href="/assets/js/21.9257327d.js"><link rel="prefetch" href="/assets/js/22.4f6009ab.js"><link rel="prefetch" href="/assets/js/23.088863b2.js"><link rel="prefetch" href="/assets/js/24.db11ce05.js"><link rel="prefetch" href="/assets/js/26.377d3afc.js"><link rel="prefetch" href="/assets/js/27.438af451.js"><link rel="prefetch" href="/assets/js/28.f6c642a7.js"><link rel="prefetch" href="/assets/js/29.f5c615a1.js"><link rel="prefetch" href="/assets/js/3.3423f2fc.js"><link rel="prefetch" href="/assets/js/30.53373ea3.js"><link rel="prefetch" href="/assets/js/31.2207fb3f.js"><link rel="prefetch" href="/assets/js/32.fa047abf.js"><link rel="prefetch" href="/assets/js/33.389da68f.js"><link rel="prefetch" href="/assets/js/34.1d3e63d7.js"><link rel="prefetch" href="/assets/js/35.6599ab41.js"><link rel="prefetch" href="/assets/js/36.1f57b0ac.js"><link rel="prefetch" href="/assets/js/37.ce825584.js"><link rel="prefetch" href="/assets/js/38.872ecdd9.js"><link rel="prefetch" href="/assets/js/39.64adb446.js"><link rel="prefetch" href="/assets/js/4.d6949b90.js"><link rel="prefetch" href="/assets/js/40.87dd1fd1.js"><link rel="prefetch" href="/assets/js/41.e4ba8e7c.js"><link rel="prefetch" href="/assets/js/42.63fba3d4.js"><link rel="prefetch" href="/assets/js/43.c22d2b85.js"><link rel="prefetch" href="/assets/js/44.7f312426.js"><link rel="prefetch" href="/assets/js/45.8fc2926c.js"><link rel="prefetch" href="/assets/js/46.b3603583.js"><link rel="prefetch" href="/assets/js/47.d758e8e8.js"><link rel="prefetch" href="/assets/js/48.45758fdd.js"><link rel="prefetch" href="/assets/js/5.b7186d48.js"><link rel="prefetch" href="/assets/js/6.ffe6f60a.js"><link rel="prefetch" href="/assets/js/7.bd4ddb9c.js"><link rel="prefetch" href="/assets/js/8.1cd3b38f.js"><link rel="prefetch" href="/assets/js/9.74ddecf3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9acbc36c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo_icon.png" alt="Laravel Actions" class="logo"> <span class="site-name can-hide">Laravel Actions</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Версия" class="dropdown-title"><span class="title">Версия</span> <span class="arrow down"></span></button> <button type="button" aria-label="Версия" class="mobile-dropdown-title"><span class="title">Версия</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.x
</a></li><li class="dropdown-item"><!----> <a href="/1.x/" class="nav-link">
  1.x
</a></li></ul></div></div> <a href="https://github.com/lorisleiva/laravel-actions" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Версия" class="dropdown-title"><span class="title">Версия</span> <span class="arrow down"></span></button> <button type="button" aria-label="Версия" class="mobile-dropdown-title"><span class="title">Версия</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  2.x
</a></li><li class="dropdown-item"><!----> <a href="/1.x/" class="nav-link">
  1.x
</a></li></ul></div></div> <a href="https://github.com/lorisleiva/laravel-actions" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Начало работы</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/" aria-current="page" class="sidebar-link">Введение</a></li><li><a href="/2.x/installation.html" class="sidebar-link">Установка</a></li><li><a href="/2.x/basic-usage.html" class="sidebar-link">Основное применение</a></li><li><a href="/2.x/upgrade.html" class="sidebar-link">Обновление с 1.x</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Учитесь на примерах</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2.x/examples/generate-reservation-code.html" class="sidebar-link">Generate reservation code</a></li><li><a href="/2.x/examples/get-user-profile.html" class="sidebar-link">Get user profile</a></li><li><a href="/2.x/examples/create-new-article.html" class="sidebar-link">Create new article</a></li><li><a href="/2.x/examples/export-user-data.html" class="sidebar-link">Export user data</a></li><li><a href="/2.x/examples/demote-team-membership.html" class="sidebar-link">Demote team membership</a></li><li><a href="/2.x/examples/synchronize-contacts-from-google.html" class="sidebar-link">Synchronize contacts from Google</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Руководство</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2.x/one-class-one-task.html" class="sidebar-link">Один класс, одна задача</a></li><li><a href="/2.x/register-as-controller.html" class="sidebar-link">Зарегистрируйте свою задачу как контроллер</a></li><li><a href="/2.x/add-validation-to-controllers.html" class="sidebar-link">Добавление валидации в свои контроллеры</a></li><li><a href="/2.x/dispatch-jobs.html" class="sidebar-link">Отправка асинхронных заданий</a></li><li><a href="/2.x/listen-for-events.html" class="sidebar-link">Слушатель для событий</a></li><li><a href="/2.x/execute-as-commands.html" class="sidebar-link">Выполнять как команды</a></li><li><a href="/2.x/mock-and-test.html" class="sidebar-link">Инсценируйте и проверьте свои действия</a></li><li><a href="/2.x/granular-traits.html" class="sidebar-link">Более детальные трейты</a></li><li><a href="/2.x/how-does-it-work.html" class="sidebar-link">Как это работает?</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Ссылки</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2.x/as-object.html" class="sidebar-link">As object</a></li><li><a href="/2.x/as-controller.html" aria-current="page" class="active sidebar-link">As controller</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#method-provided" class="sidebar-link">Method provided</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#invoke" class="sidebar-link">__invoke</a></li></ul></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#method-used" class="sidebar-link">Method used</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#ascontroller" class="sidebar-link">asController</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#jsonresponse" class="sidebar-link">jsonResponse</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#htmlresponse" class="sidebar-link">htmlResponse</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getcontrollermiddleware" class="sidebar-link">getControllerMiddleware</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#routes" class="sidebar-link">routes</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#prepareforvalidation" class="sidebar-link">prepareForValidation</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#authorize" class="sidebar-link">authorize</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#rules" class="sidebar-link">rules</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#withvalidator" class="sidebar-link">withValidator</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#aftervalidator" class="sidebar-link">afterValidator</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidator" class="sidebar-link">getValidator</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationdata" class="sidebar-link">getValidationData</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationmessages" class="sidebar-link">getValidationMessages</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationattributes" class="sidebar-link">getValidationAttributes</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationredirect" class="sidebar-link">getValidationRedirect</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationerrorbag" class="sidebar-link">getValidationErrorBag</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getvalidationfailure" class="sidebar-link">getValidationFailure</a></li><li class="sidebar-sub-header"><a href="/2.x/as-controller.html#getauthorizationfailure" class="sidebar-link">getAuthorizationFailure</a></li></ul></li></ul></li><li><a href="/2.x/as-job.html" class="sidebar-link">As job</a></li><li><a href="/2.x/as-listener.html" class="sidebar-link">As listener</a></li><li><a href="/2.x/as-command.html" class="sidebar-link">As command</a></li><li><a href="/2.x/as-fake.html" class="sidebar-link">As fake</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="as-controller"><a href="#as-controller" class="header-anchor">#</a> As controller</h1> <h2 id="method-provided"><a href="#method-provided" class="header-anchor">#</a> Method provided</h2> <p><em>Lists all methods provided by the trait.</em></p> <h3 id="invoke"><a href="#invoke" class="header-anchor">#</a> <code>__invoke</code></h3> <p>Executes the action by delegating immediately to the <code>handle</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$action</span><span class="token punctuation">(</span><span class="token variable">$someArguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Equivalent to:</span>
<span class="token variable">$action</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token variable">$someArguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Whilst this method is not actually used, it has to be defined on the action in order to register the action as an invokable controller. When missing, Laravel will throw an exception warning us that we're trying to register a class as an invokable controller without the <code>__invoke</code> method. The truth is, the controller will actually be an instance of <code>ControllerDecorator</code> but the framework doesn't know that yet.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Illuminate\Routing\RouteAction</span>

<span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">makeInvokable</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">method_exists</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'__invoke'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnexpectedValueException</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Invalid route action: [<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$action</span><span class="token punctuation">}</span></span>].&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$action</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'@__invoke'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If you need to use the <code>__invoke</code> method for something else, you may <a href="https://stackoverflow.com/a/11939306/11440277" target="_blank" rel="noopener noreferrer">override it<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with anything you want. The only requirement is that an <code>__invoke</code> method has to exists.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">MyAction</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">AsAction</span> <span class="token punctuation">{</span>
        __invoke <span class="token keyword">as</span> <span class="token keyword">protected</span> invokeFromLaravelActions<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="method-used"><a href="#method-used" class="header-anchor">#</a> Method used</h2> <p><em>Lists all methods recognised and used by the <code>ControllerDecorator</code> and <code>ActionRequest</code>.</em></p> <h3 id="ascontroller"><a href="#ascontroller" class="header-anchor">#</a> <code>asController</code></h3> <p>Called when used as an invokable controller. Uses the <code>handle</code> method directly when no <code>asController</code> method exists.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">asController</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Response
<span class="token punctuation">{</span>
    <span class="token variable">$article</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">handle</span><span class="token punctuation">(</span>
        <span class="token variable">$user</span><span class="token punctuation">,</span>
        <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'body'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'articles.show'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$article</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jsonresponse"><a href="#jsonresponse" class="header-anchor">#</a> <code>jsonResponse</code></h3> <p>Called after the <code>asController</code> method when the request expects JSON. The first argument is the return value of the <code>asController</code> method and the second argument is the request itself.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">jsonResponse</span><span class="token punctuation">(</span>Article <span class="token variable">$article</span><span class="token punctuation">,</span> Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ArticleResource
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArticleResource</span><span class="token punctuation">(</span><span class="token variable">$article</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="htmlresponse"><a href="#htmlresponse" class="header-anchor">#</a> <code>htmlResponse</code></h3> <p>Called after the <code>asController</code> method when the request expects HTML. The first argument is the return value of the <code>asController</code> method and the second argument is the request itself.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">htmlResponse</span><span class="token punctuation">(</span>Article <span class="token variable">$article</span><span class="token punctuation">,</span> Request <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Response
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'articles.show'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$article</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getcontrollermiddleware"><a href="#getcontrollermiddleware" class="header-anchor">#</a> <code>getControllerMiddleware</code></h3> <p>Adds controller middleware directly in the action.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getControllerMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'auth'</span><span class="token punctuation">,</span> MyCustomMiddleware<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="routes"><a href="#routes" class="header-anchor">#</a> <code>routes</code></h3> <p>Defines some routes directly in your action.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">routes</span><span class="token punctuation">(</span>Router <span class="token variable">$router</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$router</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'author/{author}/articles'</span><span class="token punctuation">,</span> <span class="token keyword">static</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For this to work, you need to call <code>Actions::registerRoutes</code> on a service provider.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Lorisleiva<span class="token punctuation">\</span>Actions<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Actions</span><span class="token punctuation">;</span>

<span class="token comment">// Register routes from actions in &quot;app/Actions&quot; (default).</span>
Actions<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">registerRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register routes from actions in &quot;app/MyCustomActionsFolder&quot;.</span>
Actions<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">registerRoutes</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'app/MyCustomActionsFolder'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Register routes from actions in multiple folders.</span>
Actions<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">registerRoutes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'app/Authentication'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app/Billing'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'app/TeamManagement'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="prepareforvalidation"><a href="#prepareforvalidation" class="header-anchor">#</a> <code>prepareForValidation</code></h3> <p>Called right before authorization and validation is resolved.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">prepareForValidation</span><span class="token punctuation">(</span>ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'some'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'additional data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="authorize"><a href="#authorize" class="header-anchor">#</a> <code>authorize</code></h3> <p>Defines authorization logic for the controller.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span>ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> bool
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">role</span> <span class="token operator">===</span> <span class="token single-quoted-string string">'author'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>You may also return gate responses instead of booleans.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">use</span> Illuminate\<span class="token package">Auth<span class="token punctuation">\</span>Access<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">authorize</span><span class="token punctuation">(</span>ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Response
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">role</span> <span class="token operator">!==</span> <span class="token single-quoted-string string">'author'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">deny</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'You must be an author to create a new article.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> Respone<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="rules"><a href="#rules" class="header-anchor">#</a> <code>rules</code></h3> <p>Provides the validation rules for the controller.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">rules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'required'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'min:8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'body'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'required'</span><span class="token punctuation">,</span> IsValidMarkdown<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="withvalidator"><a href="#withvalidator" class="header-anchor">#</a> <code>withValidator</code></h3> <p>Adds custom validation logic to the existing validator.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Validation<span class="token punctuation">\</span>Validator</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">withValidator</span><span class="token punctuation">(</span>Validator <span class="token variable">$validator</span><span class="token punctuation">,</span> ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>Validator <span class="token variable">$validator</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> Hash<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'current_password'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'current_password'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Wrong password.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="aftervalidator"><a href="#aftervalidator" class="header-anchor">#</a> <code>afterValidator</code></h3> <p>Adds an <code>after</code> callback to the existing validator. The example below is equivalent to the example provided in the <code>withValidator</code> method.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Validation<span class="token punctuation">\</span>Validator</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">afterValidator</span><span class="token punctuation">(</span>Validator <span class="token variable">$validator</span><span class="token punctuation">,</span> ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> Hash<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'current_password'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$validator</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'current_password'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Wrong password.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidator"><a href="#getvalidator" class="header-anchor">#</a> <code>getValidator</code></h3> <p>Defines your own validator instead of the default one generated using <code>rules</code>, <code>withValidator</code>, etc.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Validation<span class="token punctuation">\</span>Factory</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Validation<span class="token punctuation">\</span>Validator</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidator</span><span class="token punctuation">(</span>Factory <span class="token variable">$factory</span><span class="token punctuation">,</span> ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Validator
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'title'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'required'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'min:8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'body'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'required'</span><span class="token punctuation">,</span> IsValidMarkdown<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationdata"><a href="#getvalidationdata" class="header-anchor">#</a> <code>getValidationData</code></h3> <p>Defines the data that should be used for validation. Defaults to: <code>$request-&gt;all()</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationData</span><span class="token punctuation">(</span>ActionRequest <span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationmessages"><a href="#getvalidationmessages" class="header-anchor">#</a> <code>getValidationMessages</code></h3> <p>Customises the messages of your validation rules.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationMessages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title.required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Looks like you forgot the title.'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'body.required'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Is that really all you have to say?'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationattributes"><a href="#getvalidationattributes" class="header-anchor">#</a> <code>getValidationAttributes</code></h3> <p>Provides some human-friendly mapping to your request attributes.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">array</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'headline'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'body'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'content'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationredirect"><a href="#getvalidationredirect" class="header-anchor">#</a> <code>getValidationRedirect</code></h3> <p>Customises the redirect URL when validation fails. Defaults to redirecting back to the previous page.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationRedirect</span><span class="token punctuation">(</span>UrlGenerator <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$url</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/my-custom-redirect-url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationerrorbag"><a href="#getvalidationerrorbag" class="header-anchor">#</a> <code>getValidationErrorBag</code></h3> <p>Customises the validator's error bag when validation fails. Defaults to: <code>default</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationErrorBag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> string
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token single-quoted-string string">'my_custom_error_bag'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getvalidationfailure"><a href="#getvalidationfailure" class="header-anchor">#</a> <code>getValidationFailure</code></h3> <p>Overrides the validation failure altogether. Defaults to: <code>ValidationException</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getValidationFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyCustomValidationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="getauthorizationfailure"><a href="#getauthorizationfailure" class="header-anchor">#</a> <code>getAuthorizationFailure</code></h3> <p>Overrides the authorization failure. Defaults to: <code>AuthorizationException</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getAuthorizationFailure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> void
<span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyCustomAuthorizationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/laravel-ru/laravel-actions-docs/edit/main-ru/2.x/as-controller.md" target="_blank" rel="noopener noreferrer">Редактировать эту страницу</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Последнее обновление:</span> <span class="time">1/8/2021, 6:08:02 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/2.x/as-object.html" class="prev">
        As object
      </a></span> <span class="next"><a href="/2.x/as-job.html">
        As job
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.97df651c.js" defer></script><script src="/assets/js/2.6967e0a2.js" defer></script><script src="/assets/js/25.b1944ca4.js" defer></script>
  </body>
</html>
